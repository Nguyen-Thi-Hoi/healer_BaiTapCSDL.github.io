

-- Quản lý đề tài cách 2
-- Cách thoải mái, không cần theo trình tự
-- Bước 1: Tạo database
-- Bước 2: Tạo bảng và khóa chính
-- Bước 3: Thêm dữ liệu cho bảng (Bảng có như thế nào thì mình nhập như vậy)
-- Bước 4: Tạo khóa ngoại

-- So sánh xem giữa 2 cách:
-- + Khó khăn , thuận lợi giữa 2 cách

 ---- B1 : Tao Database ---
USE MASTER
GO

CREATE DATABASE QLDT_C2
GO

USE QLDT_C2
GO

---- B2 : Tao bang va khoa chinh ---

CREATE TABLE THAMGIADT
(
    MAGV       NVARCHAR (50),
	MADT       NVARCHAR (50),
	STT        INT,
	PHUCAP     FLOAT,
	KETQUA     NVARCHAR (50)

	CONSTRAINT PK_THAMGIADT PRIMARY KEY (MAGV, MADT, STT )
)
GO

CREATE TABLE KHOA
(
   MAKHOA       NVARCHAR (50),
   TENKHOA      NVARCHAR (50),
   NAMTL        INT,
   PHONG        NVARCHAR (50),
   DIENTHOAI    NVARCHAR (50),
   TRUONGKHOA   NVARCHAR (50),
   NGAYNHANCHUC DATE

   CONSTRAINT PK_KHOA PRIMARY KEY (MAKHOA),

)
GO

CREATE TABLE BOMON
(
    MABM         NVARCHAR (50),
	TENBM        NVARCHAR (50),
	PHONG        NVARCHAR (50),
	DIENTHOAI    NVARCHAR (50),
	TRUONGBOMON  NVARCHAR (50),
	MAKHOA       NVARCHAR (50),
	NGAYNHANCHUC DATE

	CONSTRAINT PK_BOMON PRIMARY KEY (MABM),

)
GO

-- THAY ĐỔI KIỂU DỮ LIỆU CỘT--
-- ALTER TABLE TÊN BẢNG
-- ALTER COLUMN TÊN CỘT KIỂU DỮ LIỆU


CREATE TABLE CONGVIEC
(
   MADT       NVARCHAR (50),
   SOTT       INT,
   TENCV      NVARCHAR (50),
   NGAYBD     DATE,
   NGAYKT     DATE

   CONSTRAINT PK_CONGVIEC PRIMARY KEY (MADT, SOTT),
)
GO


CREATE TABLE GIAOVIEN
(
    MAGV      NVARCHAR (50),
	HOTEN     NVARCHAR (50),
	LUONG     FLOAT,
	PHAI      NVARCHAR (50),
	NGSINH    DATETIME,
	DIACHI    NVARCHAR (50),
	GVQLCM    NVARCHAR (50),
	MABM      NVARCHAR (50)

	CONSTRAINT PK_GIAOVIEN PRIMARY KEY (MAGV),
)
GO


CREATE TABLE GV_DT
(
   MAGV       NVARCHAR (50),
   DIENTHOAI  NVARCHAR (50),

   CONSTRAINT PK_GV_DT PRIMARY KEY (MAGV, DIENTHOAI ),
)
GO


CREATE TABLE DETAI
(
   MADT       NVARCHAR (50),
   TENDT      NVARCHAR (50),
   CAPQL      NVARCHAR (50),
   KINHPHI    FLOAT,
   NGAYBD     DATE,
   NGAYKT     DATE,
   MACD       NVARCHAR (50),
   GVCNDT     NVARCHAR (50)

   CONSTRAINT PK_DETAI PRIMARY KEY ( MADT ),
)
GO


CREATE TABLE CHUDE
(
   MACD      NVARCHAR (50),
   TENCD     NVARCHAR (50)

   CONSTRAINT PK_CHUDE PRIMARY KEY (MACD ),
)
GO


CREATE TABLE NGUOITHAN
(
   MAGV     NVARCHAR (50),
   TEN      NVARCHAR (50),
   NGSINH   DATE,
   PHAI     NVARCHAR (50)

   CONSTRAINT PK_NGUOITHAN PRIMARY KEY (MAGV, TEN ),
)
GO

--    Tao rang buoc mien gia tri --

ALTER TABLE GIAOVIEN
ADD CONSTRAINT CK_GV_PHAI CHECK ( PHAI IN (N'Nam', N'Nữ'));
GO

ALTER TABLE NGUOITHAN
ADD CONSTRAINT CK_NGUOITHAN_PHAI CHECK ( PHAI IN (N'Nam', N'Nữ' ));
GO


-- Bước 3: Thêm dữ liệu cho bảng (Bảng có như thế nào thì mình nhập như vậy)

 -- Thêm dữ liệu cho bảng CONGVIEC --

 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '001', 1, N' Khởi tạo và lập kế hoạch', '2007-10-20', ' 2008- 12-20' );
 GO

 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '001', 2, N' Xác định yêu cầu', '2008-12-21', ' 2008- 03-21' );
 GO
 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '001', 3, N' Phân tích hệ thống ', '2008-03-20', ' 2008- 05-22' );
 GO
 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '001', 4, N'Thiết kế hệ thống', '2008-05-20', ' 2008- 12-20' );
 GO
 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '001', 5, N' Cài đặt thử nghiệm', '2008-06-20', ' 2008- 12-20' );
 GO

 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '002', 1, N' Khởi tạo và lập kế hoạch ', '2009 -05 -20', ' 2009 - 12-20' );
 GO

 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '002', 2, N' Xác định yêu cầu', '2009 - 12 -21', ' 2009- 03-21' );
 GO

 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '002', 3, N' Phân tích hệ thống', '2009 -03-22', ' 2009- 05-22' );
 GO

 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '002', 4, N' Thiết kế hệ thống', '2009 -06 -24', ' 2009- 10-20' );
 GO

 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '002', 5, N' Cài đặt thử nghiệm', '2010-05-20', ' 2010- 10-20' );
 GO
 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '006', 1, N' Lấy mẫu', '2009-10-20', ' 2008- 12-20' );
 GO
 INSERT INTO CONGVIEC ( MADT, SOTT, TENCV, NGAYBD, NGAYKT)
 VALUES               ( '006', 2, N' Nuôi cấy', '2009-10-20', ' 2008- 12-20' );
 GO

 

 -- Nhập dữ liệu cho bảng THAMGIADT ---

 INSERT INTO THAMGIADT ( MAGV, MADT, STT, PHUCAP, KETQUA)
 VALUES                ( '001', '002', 1, 0.0 , NULL);
 GO

 INSERT INTO THAMGIADT (MAGV, MADT, STT, PHUCAP, KETQUA)
 VALUES                ( '001', '002', 2, 2.2 , NULL);
 GO

INSERT INTO  THAMGIADT (MADT, MADT, STT, PHUCAP, KETQUA)
VALUES                 ('002', '001', 4, 2.0 , N'Đạt' );
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '003', '001', 1, 1.0, N'Đạt');
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '003', '001', 2, 0.0, N'Đạt');
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '003', '001', 4, 1.0, 'Đạt');
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '003', '002', 2, 0.0, NULL);
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '004', '006', 1, 0.0, N'Đạt');
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '004', '006', 2, 1.0, N'Đạt');
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '006', '006', 2, 1.5, N'Đạt');
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '009', '002', 3, 0.5, NULL);
GO

INSERT INTO THAMGIADT  (MAGV, MADT, STT, PHUCAP, KETQUA)
VALUES                 ( '009', '002', 4, 1.5, NULL);
GO

-- Điền thông tin cho bảng NGUOITHAN --

INSERT INTO NGUOITHAN ( MAGV, TEN, NGSINH, PHAI)
VALUES                ( '001', N' Hùng', ' 1990-01-14', N'Nam');
GO

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI)
VALUES                ( '001', N'Thủy', '1994-12-08', N'Nữ');
GO

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI)
VALUES                ( '003', N'Hà', '1998-09-03', N'Nữ');
GO

INSERT INTO NGUOITHAN ( MAGV, TEN, NGSINH, PHAI)
VALUES                ( '003', N'Thu', '1998-09-03', N'Nữ');
GO

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI)
VALUES                ('007', N'Mai','03/26/2003',N'Nữ');
GO

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI)
VALUES                ('007', N'Vy','02/14/2000',N'Nữ');
GO

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI)
VALUES                ('008', N'Nam','05/06/1991',N'Nam');
GO

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI)
VALUES                ('009', N'An','08/19/1996', N'Nam');
GO

INSERT INTO NGUOITHAN (MAGV, TEN, NGSINH, PHAI)
VALUES                ('010',N'Nguyệt','01/14/1990', N'Nữ');
GO

SELECT * FROM NGUOITHAN
 GO
-- Nhập dữ liệu cho bảng KHOA --

INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
VALUES			 ('CNTT',N'Công nghệ thông tin','1995','B11','0838123456','002','02/20/2005');
GO

INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
VALUES			 ('HH',N'Hóa học','1980','B41','0838456456','007','10/15/2001');
GO

INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
VALUES			 ('SH',N'Sinh học','1980','B31','0838454545','004','10/11/2000');
GO

INSERT INTO KHOA (MAKHOA, TENKHOA, NAMTL, PHONG, DIENTHOAI, TRUONGKHOA, NGAYNHANCHUC)
VALUES			 ('VL',N'Vật lý','1976','B21','0838223223','005','09/18/2003');
GO

SELECT * FROM KHOA
 GO

-- Nhập dữ liệu cho bảng GIAOVIEN --

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('001',N'Nguyễn Hoài An',2000, N'Nam','02/15/1973', N'25/3 Lạc Long Quân, Q.10, TP HCM',NULL,NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('002',N'Trần Trà Hương',2500.0, N'Nữ','06/20/1960', N'125 Trần Hưng Đạo, Q.1, TP HCM',NULL,NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('003',N'Nguyễn Ngọc Ánh',2200, N'Nữ','05/11/1975', N'12/21 Võ Văn Ngân Thủ Đức, TP HCM','002',NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('004',N'Trương Nam Sơn',2300, N'Nam','06/20/1959', N'215 Lý Thường Kiệt, TP Biên Hòa',NULL,NULL );
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('005',N'Lý Hoàng Hà',2500, N'Nam','10/23/1954', N'22/5 Nguyễn Xí, Q.Bình Thạnh, TP HCM',NULL,NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES ('006',N'Trần Bạch Tuyết',1500, N'Nữ','05/20/1980', N'127 Hùng Vương, TP Mỹ Tho','004',NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('007',N'Nguyễn An Trung',2100,'Nam','06/05/1976',N'234 3/2, TP Biên Hòa',NULL,NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('008',N'Trần Trung Hiếu',1800, N'Nam','08/06/1977',N'22/11 Lý Thường Kiệt, TP Mỹ Tho','007',NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('009',N'Trần Hoàng Nam',2000, N'Nam','11/22/1975',N'234 Trấn Não, An Phú, TP HCM','001',NULL);
GO

INSERT INTO GIAOVIEN (MAGV, HOTEN, LUONG, PHAI, NGSINH, DIACHI, GVQLCM, MABM)
VALUES				 ('010',N'Phạm Nam Thanh',1500, N'Nam', '12/12/1980', N'221 Hùng Vương, Q5, TP HCM','007',NULL);
GO

-- Nhập dữ liệu cho bảng CHUDE --

INSERT INTO CHUDE(MACD, TENCD)
VALUES			 ('NCPT', N'Nghiên cứu phát triển');
GO

INSERT INTO CHUDE(MACD, TENCD)
VALUES		 	 ('QLGD', N'Quản lý giáo dục');
GO

INSERT INTO CHUDE(MACD, TENCD)
VALUES			 ('UDCN', N'Ứng dụng công nghệ');
GO

SELECT * FROM GIAOVIEN
GO

-- Nhập dữ liệu cho bảng DETAI --

INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
VALUES			  ('001',N'HTTT quản lý các trường ĐH',N'ĐHQG',20,'10/20/2007','10/20/2008','QLGD','002');
GO

INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
VALUES			  ('002',N'HTTT quản lý giáo vụ cho 1 khoa',N'Trường',20,'10/12/2000','10/12/2001','QLGD','002');
GO

INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
VALUES			  ('003',N'Nghiên cứu chế tạo sợi Nanô Platin',N'ĐHQG',300,'10/20/2007','10/20/2008','NCPT','005');
GO

INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
VALUES			  ('004',N'Tạo vật liệu sinh học bằng màng ối người',N'Nhà nước',100,'10/20/2007','10/20/2008','NCPT','004');


INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
VALUES            ('005',N'Ứng dụng hóa học xanh',N'Trường',200,'10/20/2007','10/20/2008',N'UDCN','007');
GO

INSERT INTO DETAI (MADT, TENDT, CAPQL, KINHPHI, NGAYBD, NGAYKT, MACD, GVCNDT)
VALUES			  ('007',N'HTTT quản lý thư viện ở các trường ĐH',N'Trường',20,'10/20/2007','10/20/2008','QLGD','001');
GO


-- Nhập dữ liệu cho bảng BOMON -- 

INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, TRUONGBOMON, MAKHOA, NGAYNHANCHUC)
VALUES		   	  ('CNTT',N'Công nghệ tri thức','B15','0838126126',NULL,'CNTT',NULL);
GO

INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, TRUONGBOMON, MAKHOA, NGAYNHANCHUC)
VALUES			  ('HHC',N'Hóa hữu cơ','B44','838222222',NULL,'HH',NULL);
GO

INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, TRUONGBOMON, MAKHOA, NGAYNHANCHUC)
VALUES			  ('HL',N'Hóa lý','B42','0838878787',NULL,'HH',NULL);
GO

INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, TRUONGBOMON, MAKHOA, NGAYNHANCHUC)
VALUES			  ('HPT',N'Hóa phân tích','B43','0838777777','007','HH','10/15/2007');
GO

INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, TRUONGBOMON, MAKHOA, NGAYNHANCHUC)
VALUES			  ('HTTT',N'Hệ thống thông tin','B13','0838125125','002','CNTT','09/20/2004');

INSERT INTO BOMON (MABM, TENBM, PHONG, DIENTHOAI, TRUONGBOMON , MAKHOA, NGAYNHANCHUC)
VALUES			  ('MMT',N'Mạng máy tính','B16','0838676767','001','CNTT','05/15/2005');
GO

-- Nhập dữ liệu cho bảng GV_DT --

INSERT INTO GV_DT(MAGV, DIENTHOAI)
VALUES			 ('001','0838912112');
GO

INSERT INTO GV_DT (MAGV, DIENTHOAI)
VALUES ('001','0903123123')
GO

INSERT INTO GV_DT(MAGV, DIENTHOAI)
VALUES			 ('002','0913454545');
GO

INSERT INTO GV_DT (MAGV, DIENTHOAI)
VALUES			  ('003','0838121212');
GO

INSERT INTO GV_DT(MAGV, DIENTHOAI)
VALUES			 ('003','0903656565')
GO

INSERT INTO GV_DT (MAGV, DIENTHOAI)
VALUES			  ('003','0937125125')
GO

INSERT INTO GV_DT(MAGV, DIENTHOAI)
VALUES			 ('006','0937888888');
GO

INSERT INTO GV_DT (MAGV, DIENTHOAI)
VALUES            ('008','0653717171');
GO

INSERT INTO GV_DT (MAGV, DIENTHOAI)
VALUES            ('008','0913232323');
GO

SELECT * FROM GV_DT
GO


-- Tạo khóa ngoại cho các bảng --

-- tạo khóa ngoại cho bảng GIAOVIEN --

ALTER TABLE GV_DT
ADD CONSTRAINT FK_GV_DT FOREIGN KEY ( MAGV ) REFERENCES GIAOVIEN (MAGV);
GO

ALTER TABLE NGUOITHAN
ADD CONSTRAINT FK_GV_NGUOITHAN FOREIGN KEY (MAGV ) REFERENCES GIAOVIEN (MAGV);
GO

ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_GV_THAMGIADT FOREIGN KEY (MAGV ) REFERENCES GIAOVIEN (MAGV );
GO

ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_GV_GIAOVIEN FOREIGN KEY ( GVQLCM ) REFERENCES GIAOVIEN (MAGV);
GO


ALTER TABLE BOMON
ADD CONSTRAINT FK_GV_BOMON FOREIGN KEY (TRUONGBOMON) REFERENCES GIAOVIEN (MAGV);
GO

ALTER TABLE KHOA
ADD CONSTRAINT FK_GV_KHOA FOREIGN KEY (TRUONGKHOA ) REFERENCES GIAOVIEN (MAGV);
GO

ALTER TABLE DETAI
ADD CONSTRAINT FK_GV_DETAI FOREIGN KEY ( GVCNDT ) REFERENCES GIAOVIEN (MAGV );
GO

-- Tao khoa ngoai tham chieu den bang BOMON --

ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_BM_GIAOVIEN FOREIGN KEY ( MABM ) REFERENCES BOMON ( MABM);
GO

-- tao khoa ngoai tham chieu den bang KHOA --

ALTER TABLE BOMON
ADD CONSTRAINT FK_K_BOMON FOREIGN KEY ( MAKHOA ) REFERENCES KHOA ( MAKHOA );
GO

-- Tao khoa ngoai tham chieu den bang CONGVIEC

ALTER TABLE THAMGIADT
ADD CONSTRAINT FK_CV_THAMGIADT FOREIGN KEY (MADT, STT) REFERENCES CONGVIEC (MADT,SOTT );
GO



--  Tao khoa ngoai tham chieu den bang CHUDE --

ALTER TABLE DETAI
ADD CONSTRAINT FK_CD_DETAI FOREIGN KEY (MACD ) REFERENCES CHUDE (MACD );
GO


-- Tạo khóa ngoại tham chiếu đến bảng DETAI --
ALTER TABLE CONGVIEC
ADD CONSTRAINT FK_DETAI_CONGVIEC FOREIGN KEY ( MADT) REFERENCES DETAI ( MADT);
GO


-- So sánh giữa 2 cách --
-- Ưu điểm cách 2 : Không cần phải tính toán nên nhập dữ liệu nào trước , hạn chế được xung đột giữa việc nhập dữ liệu  , tiết kiệm thời gian hơn . Hạn chế việc update dữ liệu.
-- Nhược điểm cách 1: Làm theo trình từ b1-b4 xung đột dữ liệu xảy ra thường xuyên nếu không nhìn được trình tự nên nhập cái gì trước - sau , phải để NULL vài chỗ , sau đó tốn thời gian update sau.
-- ==> Vote cách 2